<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Embedding Final Test</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="modal.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        .test-info {
            background: #e3f2fd;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            border-left: 4px solid #2196f3;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem;
            font-size: 1rem;
        }
        button:hover {
            background: #0056b3;
        }
        .success { background: #d4edda; border-color: #28a745; color: #155724; }
        .warning { background: #fff3cd; border-color: #ffc107; color: #856404; }
        .error { background: #f8d7da; border-color: #dc3545; color: #721c24; }
    </style>
</head>
<body>
    <h1>üé• YouTube Embedding Final Test</h1>
    
    <div class="test-container">
        <h2>Test: Verbesserte YouTube-Funktionalit√§t</h2>
        <div class="test-info">
            <strong>Ziel:</strong> Teste ob YouTube-Videos korrekt eingebettet werden k√∂nnen<br>
            <strong>Funktionen:</strong> youtube-nocookie.com Domain, erweiterte Parameter, Fallback-Mechanismus
        </div>
        
        <div style="margin: 1rem 0;">
            <input type="text" id="youtube-url" placeholder="YouTube URL eingeben..." 
                   value="https://www.youtube.com/watch?v=dQw4w9WgXcQ"
                   style="width: 70%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; margin-right: 0.5rem;">
            <button onclick="testYouTubeUrl()">üé• YouTube Test</button>
        </div>
        
        <div style="margin: 1rem 0;">
            <button onclick="testSpecificVideo('dQw4w9WgXcQ', 'Never Gonna Give You Up')">Test: Never Gonna Give You Up</button>
            <button onclick="testSpecificVideo('jNQXAC9IVRw', 'Me at the zoo')">Test: Me at the zoo</button>
            <button onclick="testSpecificVideo('9bZkp7q19f0', 'Gangnam Style')">Test: Gangnam Style</button>
        </div>
        
        <div id="test-results" style="margin-top: 2rem;"></div>
    </div>

    <!-- Include the necessary scripts -->
    <script src="storage.js"></script>
    <script src="board.js"></script>
    <script src="onpaste.js"></script>
    
    <script>
        // Mock currentBoard for testing
        window.currentBoard = {
            id: 'test-board',
            columns: [
                {
                    id: 'test-column-1',
                    title: 'Test Column'
                }
            ]
        };

        function testYouTubeUrl() {
            const url = document.getElementById('youtube-url').value.trim();
            if (!url) {
                showResult('error', 'Bitte geben Sie eine YouTube URL ein!');
                return;
            }
            
            processYouTubeTest(url);
        }
        
        function testSpecificVideo(videoId, title) {
            const url = `https://www.youtube.com/watch?v=${videoId}`;
            processYouTubeTest(url, title);
        }
        
        async function processYouTubeTest(url, expectedTitle = '') {
            const results = document.getElementById('test-results');
            results.innerHTML = '<div class="test-info">üîç Teste YouTube-Funktionalit√§t...</div>';
            
            try {
                // Test 1: URL Detection
                const isYT = isYouTubeUrl(url);
                showResult(isYT ? 'success' : 'error', `1. YouTube URL Detection: ${isYT ? '‚úÖ Erkannt' : '‚ùå Nicht erkannt'}`);
                
                if (!isYT) return;
                
                // Test 2: Video ID Extraction
                const videoId = extractYouTubeVideoId(url);
                showResult(videoId ? 'success' : 'error', `2. Video ID Extraktion: ${videoId ? `‚úÖ ${videoId}` : '‚ùå Fehlgeschlagen'}`);
                
                if (!videoId) return;
                
                // Test 3: Embed URL Generation
                const embedUrl = getYouTubeEmbedUrl(videoId);
                showResult('success', `3. Embed URL: ‚úÖ ${embedUrl}`);
                
                // Test 4: Thumbnail URL
                const thumbnailUrl = getYouTubeThumbnail(videoId);
                showResult('success', `4. Thumbnail URL: ‚úÖ ${thumbnailUrl}`);
                
                // Test 5: Preview Modal
                showResult('success', '5. Erstelle Vorschau-Modal...');
                
                const mockPreview = {
                    title: expectedTitle || 'YouTube Video Test',
                    description: 'Test Video f√ºr YouTube Embedding',
                    image: thumbnailUrl,
                    url: url,
                    isYouTube: true,
                    videoId: videoId,
                    embedUrl: embedUrl,
                    authorName: 'Test Channel'
                };
                
                const mockTarget = {
                    type: 'column',
                    columnId: 'test-column-1'
                };
                
                // Zeige Modal
                showUrlPreviewModal(mockPreview, mockTarget);
                showResult('success', '6. ‚úÖ YouTube Vorschau-Modal ge√∂ffnet! Klicken Sie auf "‚ñ∂Ô∏è Video Player" um das Video zu testen.');
                
            } catch (error) {
                console.error('YouTube Test Error:', error);
                showResult('error', `‚ùå Fehler beim Test: ${error.message}`);
            }
        }
        
        function showResult(type, message) {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `test-info ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        // Auto-Test beim Laden
        window.addEventListener('load', function() {
            console.log('üé• YouTube Final Test geladen');
            showResult('success', 'üéØ YouTube Test-Umgebung bereit!');
            
            // Teste verf√ºgbare Funktionen
            const functions = ['isYouTubeUrl', 'extractYouTubeVideoId', 'getYouTubeEmbedUrl', 'getYouTubeThumbnail', 'showUrlPreviewModal'];
            functions.forEach(funcName => {
                const available = typeof window[funcName] === 'function';
                showResult(available ? 'success' : 'error', `Funktion ${funcName}: ${available ? '‚úÖ Verf√ºgbar' : '‚ùå Nicht gefunden'}`);
            });
        });
    </script>
</body>
</html>
