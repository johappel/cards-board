<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug: Kommentare & URLs Test</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="card.css">
    <link rel="stylesheet" href="modal.css">
    <style>
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .debug-title {
            font-weight: bold;
            color: #343a40;
            margin-bottom: 0.5rem;
        }
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin: 0.25rem;
            cursor: pointer;
        }
        .test-btn:hover {
            background: #0056b3;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>üîß Debug: Kommentare & URLs Funktionalit√§t</h1>
            <p>Teste die Speicherung und Anzeige von Kommentaren und URLs in Karten</p>
        </div>

        <div class="debug-info">
            <div class="debug-title">Debug-Informationen:</div>
            <div id="debug-output">Bereit f√ºr Tests...</div>
        </div>

        <div style="display: flex; gap: 1rem; margin: 1rem 0; flex-wrap: wrap;">
            <button class="test-btn" onclick="testCreateCardWithData()">Test: Karte mit Daten erstellen</button>
            <button class="test-btn" onclick="testEditCard()">Test: Karte bearbeiten</button>
            <button class="test-btn" onclick="testDisplayCards()">Test: Karten anzeigen</button>
            <button class="test-btn" onclick="debugCurrentBoard()">Debug: Board-Daten</button>
            <button class="test-btn" onclick="clearTestData()">Test-Daten l√∂schen</button>
        </div>

        <!-- Mini Kanban Board f√ºr Tests -->
        <div class="kanban-board" id="kanban-board" style="min-height: 400px; border: 2px dashed #ccc; padding: 1rem;">
            <!-- Spalten werden hier eingef√ºgt -->
        </div>

        <!-- Test-Ergebnisse -->
        <div class="debug-info">
            <div class="debug-title">Test-Ergebnisse:</div>
            <div id="test-results">Noch keine Tests durchgef√ºhrt...</div>
        </div>
    </div>

    <!-- Include all necessary scripts -->
    <script src="storage.js"></script>
    <script src="utils.js"></script>
    <script src="modal.js"></script>
    <script src="board.js"></script>
    <script src="column.js"></script>
    <script src="card.js"></script>
    <script src="dragdrop.js"></script>
    <script src="renderer.js"></script>

    <script>
        // Test-Board erstellen
        const testBoard = {
            id: 'test-debug-board',
            name: 'Debug Test Board',
            description: 'Zum Testen der Kommentar/URL Funktionalit√§t',
            authors: ['Tester'],
            summary: '',
            backgroundColor: '#f5f7fa',
            customStyle: '',
            columns: [
                {
                    id: 'col-1',
                    name: 'Test Spalte',
                    color: 'color-gradient-1',
                    cards: []
                }
            ],
            aiConfig: {
                provider: '',
                apiKey: '',
                model: '',
                baseUrl: ''
            }
        };

        // Board laden
        function initTestBoard() {
            window.currentBoard = testBoard;
            if (typeof renderColumns === 'function') {
                renderColumns();
            } else {
                log('WARNUNG: renderColumns Funktion nicht verf√ºgbar', 'warning');
            }
        }

        function log(message, type = 'info') {
            const output = document.getElementById('debug-output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'warning' ? 'warning' : type === 'success' ? 'success' : '';
            output.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            console.log(`[DEBUG] ${message}`);
        }

        function addTestResult(message, success = true) {
            const results = document.getElementById('test-results');
            const className = success ? 'success' : 'error';
            const icon = success ? '‚úÖ' : '‚ùå';
            results.innerHTML += `<div class="${className}">${icon} ${message}</div>`;
        }

        function testCreateCardWithData() {
            log('Test: Karte mit Kommentar und URL erstellen...');
            
            try {
                const testCard = {
                    id: generateId(),
                    heading: 'Test Karte mit Daten',
                    content: 'Das ist eine Test-Karte mit Kommentar und URL.',
                    color: 'color-gradient-2',
                    thumbnail: '',
                    comments: 'Das ist ein Test-Kommentar f√ºr die Karte',
                    url: 'https://example.com/test-url',
                    inactive: false
                };

                // Karte zur Spalte hinzuf√ºgen
                currentBoard.columns[0].cards.push(testCard);
                
                log(`Karte erstellt: ${JSON.stringify(testCard, null, 2)}`);
                
                // Board rendern
                if (typeof renderColumns === 'function') {
                    renderColumns();
                }
                
                addTestResult('Karte mit Kommentar und URL erfolgreich erstellt');
                
                // Pr√ºfen ob Kommentar und URL sichtbar sind
                setTimeout(() => {
                    const cardElement = document.querySelector(`[data-card-id="${testCard.id}"]`);
                    if (cardElement) {
                        const commentElement = cardElement.querySelector('.card-comment');
                        const urlElement = cardElement.querySelector('.card-url');
                        
                        if (commentElement) {
                            addTestResult('Kommentar wird in der Karte angezeigt');
                        } else {
                            addTestResult('FEHLER: Kommentar wird NICHT angezeigt', false);
                        }
                        
                        if (urlElement) {
                            addTestResult('URL wird in der Karte angezeigt');
                        } else {
                            addTestResult('FEHLER: URL wird NICHT angezeigt', false);
                        }
                    } else {
                        addTestResult('FEHLER: Karte wurde nicht gerendert', false);
                    }
                }, 500);
                
            } catch (error) {
                log(`FEHLER beim Erstellen der Test-Karte: ${error.message}`, 'error');
                addTestResult(`Fehler beim Erstellen: ${error.message}`, false);
            }
        }

        function testEditCard() {
            log('Test: Karte bearbeiten...');
            
            if (currentBoard.columns[0].cards.length === 0) {
                addTestResult('Keine Karte zum Bearbeiten vorhanden. Erstelle zuerst eine Karte.', false);
                return;
            }
            
            const card = currentBoard.columns[0].cards[0];
            log(`Bearbeite Karte: ${card.id}`);
            
            // Modal √∂ffnen
            if (typeof openCardModal === 'function') {
                openCardModal(currentBoard.columns[0].id, card.id);
                
                // Nach kurzer Verz√∂gerung Werte pr√ºfen
                setTimeout(() => {
                    const commentsField = document.getElementById('card-comments');
                    const urlField = document.getElementById('card-url');
                    
                    if (commentsField) {
                        log(`Kommentar-Feld Wert: "${commentsField.value}"`);
                        if (commentsField.value === card.comments) {
                            addTestResult('Kommentar-Feld korrekt bef√ºllt');
                        } else {
                            addTestResult(`FEHLER: Kommentar-Feld falsch bef√ºllt. Erwartet: "${card.comments}", Ist: "${commentsField.value}"`, false);
                        }
                    } else {
                        addTestResult('FEHLER: Kommentar-Feld nicht gefunden', false);
                    }
                    
                    if (urlField) {
                        log(`URL-Feld Wert: "${urlField.value}"`);
                        if (urlField.value === card.url) {
                            addTestResult('URL-Feld korrekt bef√ºllt');
                        } else {
                            addTestResult(`FEHLER: URL-Feld falsch bef√ºllt. Erwartet: "${card.url}", Ist: "${urlField.value}"`, false);
                        }
                    } else {
                        addTestResult('FEHLER: URL-Feld nicht gefunden', false);
                    }
                }, 200);
                
            } else {
                addTestResult('FEHLER: openCardModal Funktion nicht verf√ºgbar', false);
            }
        }

        function testDisplayCards() {
            log('Test: Kartenanzeige pr√ºfen...');
            
            currentBoard.columns[0].cards.forEach((card, index) => {
                log(`Karte ${index + 1}: ${JSON.stringify({
                    id: card.id,
                    heading: card.heading,
                    comments: card.comments,
                    url: card.url
                }, null, 2)}`);
                
                const cardElement = document.querySelector(`[data-card-id="${card.id}"]`);
                if (cardElement) {
                    const html = cardElement.innerHTML;
                    
                    if (card.comments && html.includes(card.comments)) {
                        addTestResult(`Karte ${index + 1}: Kommentar korrekt angezeigt`);
                    } else if (card.comments) {
                        addTestResult(`Karte ${index + 1}: FEHLER - Kommentar nicht angezeigt`, false);
                    }
                    
                    if (card.url && html.includes(card.url)) {
                        addTestResult(`Karte ${index + 1}: URL korrekt angezeigt`);
                    } else if (card.url) {
                        addTestResult(`Karte ${index + 1}: FEHLER - URL nicht angezeigt`, false);
                    }
                } else {
                    addTestResult(`Karte ${index + 1}: FEHLER - Element nicht gefunden`, false);
                }
            });
        }

        function debugCurrentBoard() {
            log('Debug: Aktuelle Board-Daten...');
            log(`Board: ${JSON.stringify(currentBoard, null, 2)}`);
            
            const cardCount = currentBoard.columns.reduce((sum, col) => sum + col.cards.length, 0);
            addTestResult(`Board hat ${cardCount} Karten in ${currentBoard.columns.length} Spalten`);
        }

        function clearTestData() {
            log('Test-Daten l√∂schen...');
            currentBoard.columns[0].cards = [];
            if (typeof renderColumns === 'function') {
                renderColumns();
            }
            
            // Ergebnisse l√∂schen
            document.getElementById('test-results').innerHTML = 'Test-Daten gel√∂scht...';
            addTestResult('Test-Daten erfolgreich gel√∂scht');
        }

        // Board beim Laden initialisieren
        document.addEventListener('DOMContentLoaded', function() {
            log('Debug-Seite geladen, initialisiere Test-Board...');
            initTestBoard();
            
            // Pr√ºfe verf√ºgbare Funktionen
            const functions = ['generateId', 'renderColumns', 'openCardModal', 'saveCard', 'createCardElement'];
            functions.forEach(func => {
                if (typeof window[func] === 'function') {
                    log(`‚úÖ ${func} verf√ºgbar`, 'success');
                } else {
                    log(`‚ùå ${func} NICHT verf√ºgbar`, 'error');
                }
            });
        });
    </script>
</body>
</html>
