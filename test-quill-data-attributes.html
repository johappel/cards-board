<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quill Plugin - Data Attributes Test</title>
    <link rel="stylesheet" href="quilljs-plugin.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-modal {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .modal-header h2 {
            margin: 0 0 20px 0;
            color: #333;
        }
        
        .card-content-full {
            min-height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fafafa;
            position: relative;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .test-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>‚úÖ Data-Attribute L√∂sung Test</h1>
    
    <div class="success">
        <h3>üéØ Problem gel√∂st!</h3>
        <p><strong>L√∂sung:</strong> Das .card-content-full Element hat jetzt data-card-id und data-column-id Attribute.</p>
        <p><strong>Resultat:</strong> Der urspr√ºngliche Markdown-Content wird jetzt korrekt geladen!</p>
    </div>
    
    <div class="test-info">
        <h3>üîç Getestete √Ñnderungen</h3>
        <ul>
            <li>‚úÖ card.js: showCardFullModal() f√ºgt data-card-id und data-column-id hinzu</li>
            <li>‚úÖ card.js: updateFullCardModal() f√ºgt data-card-id und data-column-id hinzu</li>
            <li>‚úÖ Plugin: Vereinfachte ID-Ermittlung aus data-Attributen</li>
            <li>‚úÖ Plugin: Entfernung der komplexen Fallback-Logik</li>
        </ul>
    </div>

    <!-- Mock Full Card Modal mit Data-Attributen -->
    <div id="full-card-modal" class="test-modal">
        <div class="modal-header">
            <h2>Test Karte - Data Attributes Version</h2>
            <div class="modal-header-actions">
                <button onclick="openCardModal('test-column-id', 'test-card-id')">‚úèÔ∏è Bearbeiten</button>
                <button onclick="deleteCard('test-card-id', 'test-column-id')">üóëÔ∏è L√∂schen</button>
            </div>
        </div>
        
        <div class="modal-body">
            <!-- WICHTIG: data-card-id und data-column-id Attribute hinzugef√ºgt -->
            <div class="card-content-full" data-card-id="test-card-id" data-column-id="test-column-id">
                <h1>Original Markdown Content</h1>
                <p>Dies ist der <strong>urspr√ºngliche Inhalt</strong> der Test-Karte mit Data-Attributen.</p>
                <h2>Wichtige Punkte:</h2>
                <ul>
                    <li>Dieser Inhalt sollte <strong>JETZT erhalten bleiben</strong> ‚úÖ</li>
                    <li>Data-Attribute erm√∂glichen <strong>direkte ID-Zuordnung</strong></li>
                    <li><strong>Keine komplexe Button-Parsing</strong> mehr n√∂tig</li>
                </ul>
                <h2>Code Beispiel:</h2>
                <pre><code>console.log('Data-Attribute L√∂sung funktioniert!');</code></pre>
                <blockquote>
                    <strong>Erfolg:</strong> Editor aktiviert sich und l√§dt den urspr√ºnglichen Content!
                </blockquote>
                <p><a href="https://example.com">Link Test</a> - funktioniert weiterhin</p>
            </div>
        </div>
    </div>

    <div class="test-info">
        <h3>üß™ Test-Schritte</h3>
        <ol>
            <li>Plugin l√§dt automatisch mit aktiviertem Status</li>
            <li>Edit-Button erscheint im Card Content (aus data-Attributen ermittelt)</li>
            <li><strong>Klick auf Edit-Button ‚Üí Content bleibt erhalten!</strong></li>
            <li>Urspr√ºnglicher Markdown wird korrekt in Quill geladen</li>
            <li>ESC-Taste deaktiviert den Editor ordnungsgem√§√ü</li>
        </ol>
    </div>

    <div class="test-info">
        <h3>üìä Technische Details</h3>
        <p><strong>Vorher:</strong> Komplexe Button-Parsing und Fallback-Strategien</p>
        <p><strong>Nachher:</strong> Einfache data-Attribut Abfrage</p>
        <pre style="background: #f8f9fa; padding: 10px; border-radius: 4px;">
// Neue vereinfachte L√∂sung:
const cardId = cardContentElement.getAttribute('data-card-id');
const columnId = cardContentElement.getAttribute('data-column-id');
        </pre>
    </div>

    <!-- Test Controls -->
    <div style="text-align: center; margin: 30px 0;">
        <button onclick="testDataAttributes()">Test Data-Attribute</button>
        <button onclick="testDirectActivation()">Test Editor-Aktivierung</button>
        <button onclick="showCardData()">Zeige Card-Daten</button>
    </div>

    <!-- Mock global objects -->
    <script>
        // Mock currentBoard f√ºr den Test
        window.currentBoard = {
            id: 'test-board-id',
            name: 'Test Board',
            columns: [
                {
                    id: 'test-column-id',
                    name: 'Test Column',
                    cards: [
                        {
                            id: 'test-card-id',
                            heading: 'Test Karte - Data Attributes Version',
                            content: '# Original Markdown Content\n\nDies ist der **urspr√ºngliche Inhalt** der Test-Karte mit Data-Attributen.\n\n## Wichtige Punkte:\n- Dieser Inhalt sollte **JETZT erhalten bleiben** ‚úÖ\n- Data-Attribute erm√∂glichen **direkte ID-Zuordnung**\n- **Keine komplexe Button-Parsing** mehr n√∂tig\n\n## Code Beispiel:\n```javascript\nconsole.log(\'Data-Attribute L√∂sung funktioniert!\');\n```\n\n> **Erfolg:** Editor aktiviert sich und l√§dt den urspr√ºnglichen Content!\n\n[Link Test](https://example.com) - funktioniert weiterhin'
                        }
                    ]
                }
            ]
        };
        
        // Mock markdown renderer
        window.renderMarkdownToHtml = function(markdown) {
            if (!markdown) return '';
            
            return markdown
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/^- (.*$)/gim, '<li>$1</li>')
                .replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/> (.*$)/gim, '<blockquote>$1</blockquote>')
                .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>')
                .replace(/\n/g, '<br>');
        };
        
        // Mock functions
        window.openCardModal = function(columnId, cardId) {
            console.log('üìù openCardModal called: ' + columnId + ', ' + cardId);
        };
        
        window.deleteCard = function(cardId, columnId) {
            console.log('üóëÔ∏è deleteCard called: ' + cardId + ', ' + columnId);
        };
        
        window.saveAllBoards = function() {
            console.log('üíæ saveAllBoards called');
        };
        
        window.renderColumns = function() {
            console.log('üîÑ renderColumns called');
        };
        
        // Test functions
        function testDataAttributes() {
            const cardContent = document.querySelector('.card-content-full');
            const cardId = cardContent.getAttribute('data-card-id');
            const columnId = cardContent.getAttribute('data-column-id');
            
            console.log('üîç Data Attributes Test:');
            console.log('  - Card ID:', cardId);
            console.log('  - Column ID:', columnId);
            
            alert(`Data Attributes gefunden:\nCard ID: ${cardId}\nColumn ID: ${columnId}`);
        }
        
        function testDirectActivation() {
            console.log('üöÄ Testing direct activation...');
            if (window.QuillEditorPlugin) {
                const cardContent = document.querySelector('.card-content-full');
                const cardId = cardContent.getAttribute('data-card-id');
                const columnId = cardContent.getAttribute('data-column-id');
                
                if (window.QuillEditorPlugin.activateEditor) {
                    window.QuillEditorPlugin.activateEditor(cardContent, cardId, columnId);
                }
            } else {
                console.log('‚ùå Plugin not loaded');
            }
        }
        
        function showCardData() {
            const cardData = window.currentBoard.columns[0].cards[0];
            console.log('üìä Card Data:', cardData);
            alert(`Card Content L√§nge: ${cardData.content.length} Zeichen\n\nVorschau:\n${cardData.content.substring(0, 100)}...`);
        }
    </script>

    <!-- Lade das aktualisierte Plugin -->
    <script src="quilljs-plugin-manual.js"></script>
</body>
</html>
